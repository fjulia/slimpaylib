{"version":3,"sources":["auth.js","client.js","halIndex.js","index.js","paymentManager.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","request","require","Auth","options","this","app_name","app_secret","oauth_url","token","renovation_date","expires_in","value","next","_this","_is_token_valid","access_token","_retrieve_token","err","Error","now","Date","callback","self","post","form","grant_type","scope","auth","user","pass","res","body","JSON","parse","Client","url","getBearer","bearer","method","headers","Authorization","Accept","profile","console","log","object","Content-Type","stringify","halIndex","links","global","sandbox_entrypoint_url","process","env","entrypoint_url","exports","Slimpaylib","creditor_reference","payment","PaymentManager","do_auth","id_user","sign_mandate","module","client","entryUrl","creditor","subscriber","do_get","lnk","mandate","_createSignMandateRequest","do_post","_links","href","reference","items","autoGenReference","type","signatory","familyName","givenName","billingAddress","street1","postalCode","city","country","started"],"mappings":"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","file":"slimpaylib.min.js","sourcesContent":["'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar request = require('request');\n\nvar Auth = function () {\n\tfunction Auth(options) {\n\t\t_classCallCheck(this, Auth);\n\n\t\tthis.app_name = options.app_name;\n\t\tthis.app_secret = options.app_secret;\n\t\tthis.oauth_url = options.oauth_url;\n\t\tthis.token = {};\n\t\tthis.renovation_date = 0;\n\t\tthis.token.expires_in = 0;\n\t}\n\n\t_createClass(Auth, [{\n\t\tkey: 'getBearer',\n\t\tvalue: function getBearer(next) {\n\t\t\tvar _this = this;\n\n\t\t\tif (!this._is_token_valid()) {\n\t\t\t\tthis._retrieve_token(function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tthrow new Error('Authentication error');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnext(_this.token.access_token);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tnext(this.token.access_token);\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: '_is_token_valid',\n\t\tvalue: function _is_token_valid() {\n\t\t\tvar now = new Date() / 1000;\n\t\t\treturn now < this.renovation_date + this.token.expires_in;\n\t\t}\n\t}, {\n\t\tkey: '_retrieve_token',\n\t\tvalue: function _retrieve_token(callback) {\n\t\t\tvar self = this;\n\t\t\trequest.post(this.oauth_url, {\n\t\t\t\tform: {\n\t\t\t\t\tgrant_type: 'client_credentials',\n\t\t\t\t\tscope: 'api'\n\t\t\t\t},\n\t\t\t\tauth: {\n\t\t\t\t\tuser: this.app_name,\n\t\t\t\t\tpass: this.app_secret\n\t\t\t\t}\n\t\t\t}, function (err, res, body) {\n\t\t\t\tself.token = JSON.parse(body);\n\t\t\t\tself.renovation_date = new Date() / 1000;\n\t\t\t\tcallback(err);\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn Auth;\n}();","'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar request = require('request');\n//require('request-debug')(request);\n\nvar Client = function () {\n\tfunction Client(auth) {\n\t\t_classCallCheck(this, Client);\n\n\t\tthis.auth = auth;\n\t}\n\n\t_createClass(Client, [{\n\t\tkey: 'do_get',\n\t\tvalue: function do_get(url, callback) {\n\t\t\tthis.auth.getBearer(function (bearer) {\n\t\t\t\tvar options = {\n\t\t\t\t\turl: url,\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Authorization': 'Bearer ' + bearer,\n\t\t\t\t\t\t'Accept': 'application/hal+json',\n\t\t\t\t\t\t'profile': 'https://api.slimpay.net/alps/v1'\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\trequest(options, function (err, res, body) {\n\t\t\t\t\tif (err) console.log(\"do_get error\", err);\n\t\t\t\t\tcallback(err, body);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'do_post',\n\t\tvalue: function do_post(url, object, callback) {\n\t\t\tthis.auth.getBearer(function (bearer) {\n\t\t\t\tvar options = {\n\t\t\t\t\turl: url,\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Authorization': 'Bearer ' + bearer,\n\t\t\t\t\t\t'Accept': 'application/hal+json',\n\t\t\t\t\t\t'profile': 'https://api.slimpay.net/alps/v1',\n\t\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify(object)\n\t\t\t\t};\n\t\t\t\trequest(options, function (err, res, body) {\n\t\t\t\t\tif (err) console.log(\"do_get error\", err);\n\t\t\t\t\tcallback(err, body);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn Client;\n}();","'use strict';\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar request = require('request');\n\nvar halIndex = function halIndex() {\n\t_classCallCheck(this, halIndex);\n\n\tthis.links = {};\n\tvar url = global.sandbox_entrypoint_url;\n\tif (process.env['NODE_ENV'] === 'production') {\n\t\turl = global.entrypoint_url;\n\t}\n};","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Slimpaylib = function () {\n  function Slimpaylib(options) {\n    _classCallCheck(this, Slimpaylib);\n\n    if (!options) throw new Error(\"Missing credentials\");\n    if (!options.app_name) throw new Error(\"Missing app_name\");\n    if (!options.app_secret) throw new Error(\"Missing app_secret\");\n    if (!options.creditor_reference) throw new Error(\"Missing creditor_reference\");\n    this.auth = new Auth(options);\n    this.payment = new PaymentManager(this.auth, options);\n  }\n\n  _createClass(Slimpaylib, [{\n    key: \"test\",\n    value: function test() {\n      var _this = this;\n\n      this.auth.do_auth(function () {\n        console.log(_this.auth.token);\n      });\n    }\n  }, {\n    key: \"sign_mandate\",\n    value: function sign_mandate(id_user, callback) {\n      this.payment.sign_mandate(id_user, callback);\n    }\n  }]);\n\n  return Slimpaylib;\n}();\n\nexports.default = Slimpaylib;\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar PaymentManager = function () {\n\tfunction PaymentManager(auth, options) {\n\t\t_classCallCheck(this, PaymentManager);\n\n\t\tthis.options = options;\n\t\tthis.client = new Client(auth);\n\t}\n\n\t_createClass(PaymentManager, [{\n\t\tkey: \"sign_mandate\",\n\t\tvalue: function sign_mandate(id_user, callback) {\n\t\t\tvar _this = this;\n\n\t\t\tvar entryUrl = this.options.sandbox_entrypoint_url;\n\t\t\tvar creditor = this.options.creditor_reference;\n\t\t\tvar subscriber = id_user;\n\t\t\t//Retrieve entry point\n\t\t\tthis.client.do_get(entryUrl, function (err, links) {\n\t\t\t\tvar lnk = JSON.parse(links);\n\t\t\t\tvar mandate = _this._createSignMandateRequest(creditor, subscriber);\n\t\t\t\t_this.client.do_post(lnk._links['https://api.slimpay.net/alps#create-orders'].href, mandate, function (err, body) {\n\t\t\t\t\tif (err) console.log(\"ERROR: Failed post mandate\", err);\n\t\t\t\t\tconsole.log(body);\n\t\t\t\t\tcallback();\n\t\t\t\t});\n\t\t\t});\n\t\t\t//Create orders\n\t\t}\n\t}, {\n\t\tkey: \"_createSignMandateRequest\",\n\t\tvalue: function _createSignMandateRequest(creditor, subscriber) {\n\t\t\tvar res = {\n\t\t\t\tcreditor: { reference: creditor },\n\t\t\t\tsubscriber: { reference: subscriber.id_user },\n\t\t\t\titems: [{\n\t\t\t\t\t\"autoGenReference\": true,\n\t\t\t\t\t\"type\": \"signMandate\",\n\t\t\t\t\t\"mandate\": {\n\t\t\t\t\t\t\"signatory\": {\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\"honorificPrefix\": \"Mr\",\n\t\t\t\t\t\t\t\"familyName\": \"Doe\",\n\t\t\t\t\t\t\t\"givenName\": \"John\",\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\"telephone\": \"+33612345678\",\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\"email\": \"john.doe@gmail.com\",\n\t\t\t\t\t\t\t\"billingAddress\": {\n\t\t\t\t\t\t\t\t\"street1\": \"27 rue des fleurs\",\n\t\t\t\t\t\t\t\t//\t\t\t\t\t\t\t\"street2\": \"Bat 2\",\n\t\t\t\t\t\t\t\t\"postalCode\": \"75008\",\n\t\t\t\t\t\t\t\t\"city\": \"Paris\",\n\t\t\t\t\t\t\t\t\"country\": \"FR\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}],\n\t\t\t\tstarted: true\n\t\t\t};\n\t\t\treturn res;\n\t\t}\n\t}]);\n\n\treturn PaymentManager;\n}();"],"sourceRoot":"/source/"}