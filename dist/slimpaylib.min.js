"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),request=require("request"),Auth=function(){function e(t){_classCallCheck(this,e),this.app_name=t.app_name,this.app_secret=t.app_secret,this.oauth_url=t.oauth_url,this.token={},this.renovation_date=0,this.token.expires_in=0}return _createClass(e,[{key:"getBearer",value:function(e){var t=this;this._is_token_valid()?e(this.token.access_token):this._retrieve_token(function(n){if(n)throw new Error("Authentication error");e(t.token.access_token)})}},{key:"_is_token_valid",value:function(){var e=new Date/1e3;return e<this.renovation_date+this.token.expires_in}},{key:"_retrieve_token",value:function(e){var t=this;request.post(this.oauth_url,{form:{grant_type:"client_credentials",scope:"api"},auth:{user:this.app_name,pass:this.app_secret}},function(n,r,a){t.token=JSON.parse(a),t.renovation_date=new Date/1e3,e(n)})}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),request=require("request"),Client=function(){function e(t){_classCallCheck(this,e),this.auth=t}return _createClass(e,[{key:"do_get",value:function(e,t){this.auth.getBearer(function(n){var r={url:e,method:"GET",headers:{Authorization:"Bearer "+n,Accept:"application/hal+json",profile:"https://api.slimpay.net/alps/v1"}};request(r,function(e,n,r){e&&console.log("do_get error",e),t(e,r)})})}},{key:"do_post",value:function(e,t,n){this.auth.getBearer(function(t){var r={url:e,method:"POST",headers:{Authorization:"Bearer "+t,Accept:"application/hal+json",profile:"https://api.slimpay.net/alps/v1"}};request(r,function(e,t,r){e&&console.log("do_get error",e),n(e,r)})})}}]),e}(),request=require("request"),halIndex=function e(){_classCallCheck(this,e),this.links={};var t=global.sandbox_entrypoint_url;"production"===process.env.NODE_ENV&&(t=global.entrypoint_url)};Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Slimpaylib=function(){function e(t){if(_classCallCheck(this,e),!t)throw new Error("Missing credentials");if(!t.app_name)throw new Error("Missing app_name");if(!t.app_secret)throw new Error("Missing app_secret");if(!t.creditor_reference)throw new Error("Missing creditor_reference");this.auth=new Auth(t),this.payment=new PaymentManager(this.auth,t)}return _createClass(e,[{key:"test",value:function(){var e=this;this.auth.do_auth(function(){console.log(e.auth.token)})}},{key:"sign_mandate",value:function(e){this.payment.sign_mandate(e)}}]),e}();exports["default"]=Slimpaylib,module.exports=exports["default"];var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),PaymentManager=function(){function e(t,n){_classCallCheck(this,e),this.options=n,this.client=new Client(t)}return _createClass(e,[{key:"sign_mandate",value:function(e){var t=this.options.sandbox_entrypoint_url;this.client.do_get(t,function(t,n){console.log(n),e()})}}]),e}();
//# sourceMappingURL=slimpaylib.min.js.map
